# AGENTS.md — Coding Agent Guide

This file provides guidance for AI coding agents working in this repository.

---

## Project Overview

Angular 21 single-page application (management control panel) using standalone components,
Angular Material 21, and SCSS. Backend is a Laravel API with Sanctum session authentication.
No NgModules — all components are standalone. UI strings are in **Spanish**.

---

## Build, Serve & Test Commands

```bash
# Install dependencies
npm install

# Dev server (generates environments.ts from .env first)
npm start            # or: npm run envs && ng serve

# Production build
npm run build

# Run all tests (Vitest via @angular/build:unit-test)
npm test             # or: ng test

# Run a single test file
ng test --include="src/app/path/to/file.spec.ts"

# Run tests matching a name pattern
ng test --reporter=verbose

# Watch mode build
npm run watch
```

There is no separate lint command — no ESLint or Biome is configured in this project.

### Environment Setup

The `.env` file is required before serving or building. Copy `.env.example` to `.env` and fill
in values. The `scripts/set-envs.js` script reads `.env` and generates `src/environments/environments.ts`.
Do **not** commit `.env` or the generated `environments.ts`.

---

## Repository Structure

```
src/
  app/
    core/              # App-wide singletons: interceptors, guards, services, interfaces
    features/
      dashboard/       # Feature: main dashboard views (products, orders, users, roles…)
      landing/         # Feature: login / unauthenticated views
    layouts/
      main-layout/     # Shell layout: header, sidebar, nested router outlet
  environments/        # Generated by scripts/set-envs.js — do not edit manually
  styles.scss          # Global styles and CSS custom properties
```

---

## TypeScript

- **Strict mode is fully enabled**: `strict`, `noImplicitOverride`, `noImplicitReturns`,
  `noPropertyAccessFromIndexSignature`, `noFallthroughCasesInSwitch`.
- `strictTemplates` and `strictInjectionParameters` are also enabled for Angular.
- Target: `ES2022`. Module: `preserve`.
- Always provide explicit return types on public methods and function interceptors.
- Avoid `any`; use proper generics or `unknown` where type is truly unknown.
- Use `readonly` on private fields that are never reassigned.

---

## Code Style & Formatting

Prettier is configured in `package.json`:

- `printWidth: 100`
- `singleQuote: true` (for `.ts` and `.js`; `.html` uses the Angular parser)
- Indent: **2 spaces** (enforced by `.editorconfig`)
- Final newline required; no trailing whitespace.

Run Prettier manually if needed: `npx prettier --write "src/**/*.{ts,html,scss}"`.

---

## Angular Conventions

### Components

- All components are **standalone** — always set `standalone: true` (or rely on the Angular 21
  default). Never create NgModules.
- Use the modern **control flow syntax** in templates (`@if`, `@for`, `@switch`).
  Do **not** use `*ngIf`, `*ngFor`, or `*ngSwitch` structural directives.
- Component class names use PascalCase **without** the `Component` suffix for layout/feature
  shells (e.g., `Sidebar`, `Header`, `MainLayout`). Service-heavy or form components may keep
  the `Component` suffix (e.g., `LoginComponent`). Follow the surrounding convention in each
  feature folder.
- Selectors are prefixed by layer/feature:
  - `app-*` — root / shell
  - `landing-*` — unauthenticated / login area
  - `dashboard-*` — authenticated dashboard views
  - `layout-*` — layout shell components

### File Naming

All files use **kebab-case**:

```
feature-name.component.ts
feature-name.component.html
feature-name.component.scss
feature-name.service.ts
feature-name.guard.ts
feature-name.interceptor.ts
feature-name.interface.ts
feature-name.routes.ts
```

### Dependency Injection

Prefer the `inject()` function in new code:

```typescript
private authService = inject(AuthService);
```

Constructor injection is acceptable in services and existing components — do not refactor
working code for this reason alone.

### State Management

Use **Angular Signals** (`signal()`, `computed()`, `toSignal()`) for local/reactive state.
No NgRx or third-party state libraries are used.

### HTTP & Observables

- Services return typed `Observable<T>`.
- Use the generic `ApiResponse<T>` / `ApiResponseNoData` wrappers defined in
  `src/app/core/interfaces/api-response.interface.ts`.
- Use `switchMap` to chain dependent requests (e.g., fetch CSRF cookie then POST).
- Use functional interceptors (`HttpInterceptorFn`) — no class-based interceptors.

### Routing

- All routes use **lazy loading** via `loadComponent` or `loadChildren`.
- Guards are functional (`CanActivateFn`) and use `inject()`.

---

## Interfaces & Types

- Define interfaces per-feature in an `interfaces/` subfolder.
- Suffix interface files with `.interface.ts`.
- Name interfaces in PascalCase without an `I` prefix (e.g., `LoginResponse`, not
  `ILoginResponse`).
- Use the shared `ApiResponse<T>` generic for all API payloads.

---

## Error Handling

- In `.subscribe()` calls, always provide both `next` and `error` callbacks:

```typescript
this.service.doSomething().subscribe({
  next: (response) => { /* handle success */ },
  error: (error) => {
    const message = error.error?.message || 'Error genérico al procesar la solicitud.';
    this.snackbarService.error(message);
    console.error(error);
  }
});
```

- In guards and operators, use `catchError` and return a safe fallback (`of(false)`).
- Surface user-facing errors through `SnackbarService` (see
  `src/app/core/services/snackbar.service.ts`).
- Always `console.error(error)` for unexpected errors to aid debugging.
- Error/success messages must be written in **Spanish**.

---

## SCSS & Styling

- Each component has its own `.scss` file (`styleUrl`).
- Global variables and CSS custom properties live in `src/styles.scss`.
- Use CSS custom properties (`--variable-name`) for theming values.
- `inlineStyleLanguage` is `scss`; do not use plain CSS files.
- Angular Material theming is applied globally — use Material design tokens where possible.

---

## Testing

- Test runner: **Vitest v4** integrated via `@angular/build:unit-test`.
- Test files: `*.spec.ts` co-located with the source file they test.
- The `tsconfig.spec.json` provides `vitest/globals` so `describe`, `it`, `expect`, etc. are
  available globally without imports.
- No test files exist yet — follow Vitest conventions when writing new tests.
- Run a single test file:

```bash
ng test --include="src/app/features/landing/services/auth.service.spec.ts"
```

---

## Documentation — Use Context7

**Always use Context7 to look up Angular documentation before writing or modifying Angular code.**
Angular 21 introduced changes that are not present in pre-2024 training data (new control flow,
`@angular/build`, signal-based APIs, etc.). Relying on memorized docs will produce outdated code.

### How to use Context7 for Angular

Resolve the library ID first, then query it:

1. Call `resolve-library-id` with `libraryName: "angular"`.
2. Use the returned ID with `query-docs` for the specific topic.

Common queries to run before implementing:

| Topic | Example query |
|---|---|
| Standalone components | `"standalone components Angular 21"` |
| Signals & `toSignal` | `"signal computed toSignal Angular"` |
| Control flow syntax | `"@if @for @switch template syntax"` |
| HTTP client / interceptors | `"HttpClient functional interceptor HttpInterceptorFn"` |
| Lazy routing | `"loadComponent loadChildren lazy route"` |
| Angular Material | `"Angular Material 21 component theming tokens"` |
| Testing with Vitest | `"unit test Angular Vitest TestBed"` |

> Do **not** assume Angular 21 APIs match Angular 14–17 docs or Stack Overflow answers from
> before 2024. Always verify with Context7.

---

## Dos and Don'ts

| Do | Don't |
|---|---|
| Use standalone components | Create NgModules |
| Use `@if` / `@for` control flow | Use `*ngIf` / `*ngFor` directives |
| Use `inject()` for new DI | Mix DI styles unnecessarily |
| Use Signals for reactive state | Use BehaviorSubject for local UI state |
| Write UI messages in Spanish | Write UI messages in English |
| Type all HTTP responses with generics | Use untyped `any` responses |
| Keep environment config in `.env` | Hardcode URLs or secrets in source files |
| Lazy-load all routes | Eagerly import feature components in routes |
| Look up Angular 21 APIs via Context7 | Rely on pre-2024 Angular knowledge |
